---
title: "PSY6422 Project"
author: "Emma Walker"
date: "2024-11-11"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

<center>
![](images/Logo_Game_of_thrones.png)

# **Game of Thrones Ratings Per Episode Per Season**

</center>
## **Background and Research Question**

**"How have the ratings of Game of Thrones episodes evolved over time across different seasons?"**

This research question will aim to explore trends in the data such as whether ratings increased or decreased over the course of the show, or whether there were any significant drops after key plot developments, for example.

## **Data**
The raw data was obtained from the IMDB website which is publicly accessible via this link:

https://www.imdb.com/title/tt0944947/ratings/

The data used in this analysis was extracted from the 'Ratings by episode' section.

### Load Packages

```{r loadlib, echo = TRUE, results = 'hide', warning = FALSE, message = FALSE}

library(tidyverse) #for data manipulation, visualization, and analysis
library(here) #simplifies paths
library(readxl) #to read excel files in R
library(knitr) #runs the R code and inserts the results back into the document
library(dplyr) #for data manipulation tasks
library(ggimage) #to add images to the legend
library(jpeg) #to read jpeg files
library(gganimate) #to create an animated plot
```

### Import the Data

```{r import}
#load data from excel file
rawdata <- read_excel(here::here("raw_data", "raw_data.xlsx"))
```

R has automatically assigned any empty values in the table to now say "...1". First, I am going to print the data to see how it looks initially after importing.

```{r}
#this is a sanity check to inspect the data
print(rawdata)
```

My data has successfully imported, the next step is to wrangle the data to convert it into a form that can be easily visualised.

### Wrangle the Data

```{r wrangle, echo=TRUE, warning=FALSE, message=FALSE}
#rename the first column after automatic assignment of "...1"
colnames(rawdata) <- ifelse(colnames(rawdata) == "...1", "Season", colnames(rawdata))

#rename the columns, excluding the first which I have just renamed to remain empty
colnames(rawdata)[-1] <- c("Episode 1", "Episode 2", "Episode 3", "Episode 4", "Episode 5", "Episode 6", "Episode 7", "Episode 8", "Episode 9", "Episode 10", "Episode 11")

#this is a sanity to check to make sure the column headers changed
head(rawdata, n = 1)

#change the values in the first column
#removing the 's' just to clean up to view of the table
rawdata$Season <- sub("s", "", rawdata$Season) 

#render the table with kable
kable(rawdata, format = "markdown")
```

The above table shows a much cleaner version of the data, however, it is not ready for visualisation yet. Before I take the data and plot it, first I am going to remove the final column containing 'Episode 11'. The reason for this is that this data is not required in the analysis as this is the unaired original pilot. Audiences never saw this episode and was simply an alternate to the official pilot episode that was released. Therefore, 'Episode 11' was excluded from the final dataset.

```{r cleaning}
# Reshape the data to long format for a more flexible structure for visualizing, analyzing, and modeling data. This is easier for ggplot2 to handle.
rawdata_long <- rawdata %>%
  pivot_longer(cols = starts_with("Episode"),  # Select columns that start with "Episode"
               names_to = "Episode",           # Create a new column "Episode"
               values_to = "Rating")          # Create a new column "Rating"

# Exclude Episode 11 from the data
data <- rawdata_long %>%
  filter(str_replace(Episode, "Episode ", "") != "11")

#this is a sanity check to make sure the data is now in a long format
head(data)

# Save the data as a CSV file, which can be opened in excel.
write.csv(data, "data/data.csv", row.names = FALSE)
```

## **Visualisation**

```{r basic visualisation, echo=TRUE, warning=FALSE, message=FALSE}
#Create a basic line plot with minimal customisation
p <- ggplot(data, aes(x = as.integer(str_replace(Episode, "Episode ", "")),  # Convert episode to numeric
                         y = Rating, 
                         color = factor(Season))) +  # Use Season for different lines
  geom_line() +                        # Draw lines
  geom_point() +                       # Add points for each episode
  labs(x = "Episode Number",            # Label for x-axis
       y = "Episode Rating",            # Label for y-axis
       color = "Season Number") +       # Label for the legend
  theme_minimal() +                    # Use a minimal theme for a clean look
  scale_color_viridis_d() +             # Add color scale for different lines
  theme(legend.position = "right")      # Place the legend at the right

#view the plot as a sanity check to assess what direction to take the customisations.
print(p)
```

Write something here about recoding the episode column to be able to change the scale

```{r scale}
# Preprocess the Episode column to extract numeric episode numbers. It removes the "Episode " part of the string and converts the remaining number (e.g., "1", "2") into an integer; creating a new column 'EpisodeNumber'
data1 <- data %>%
  mutate(EpisodeNumber = as.integer(str_replace(Episode, "Episode ", "")))

# This is a sanity check to view the new column
print(data1)
```

can write something here about customising the colours

```{r line colours}
# Convert the numeric 'Season' column to a factor with appropriate labels
data1$Season <- factor(data1$Season, 
                       levels = 1:8, 
                       labels = c("Season 1", "Season 2", "Season 3", "Season 4", "Season 5", "Season 6", "Season 7", "Season 8"))

# Assign custom colors to each line based on the season
custom_colors <- c(
  "Season 1" = "#7f7f7f",   # Grey for Season 1, House Stark
  "Season 2" = "#ffc406",   # Yellow for Season 2, House Baratheon
  "Season 3" = "#006400",   # Green for Season 3, House Tyrell
  "Season 4" = "#ED7014",   # Orange for Season 4, House Martel
  "Season 5" = "#B03060",   # Maroon for Season 5, House Lannister
  "Season 6" = "#023E8A",   # Blue for Season 6, House Arryn
  "Season 7" = "#000000",   # Black for Season 7, House Greyjoy
  "Season 8" = "#ff0000"    # Red for Season 8, House Targaryen
)
```


```{r house custom colors, echo=FALSE, results="asis"}
# HTML and CSS for 4-column layout
cat('<div style="display: flex; flex-wrap: wrap; justify-content: space-between;">')

# Loop through the seasons and create the layout
for (i in 1:8) {
  season_name <- paste("Season", i)
  season_color <- custom_colors[season_name]
  image_path <- paste("images/season", i, ".jpg", sep="")
  
  # Create HTML content with image and color description
  cat('<div style="flex: 0 0 23%; margin-bottom: 20px; text-align: center;">')
  cat('<img src="', image_path, '" style="width: 100%; max-width: 150px; height: auto;">')
  cat('<p><strong>', season_name, '</strong>: ', season_color, '</p>')
  cat('</div>')
}

# Close the container
cat('</div>')
```



```{r customised visualisation, echo=TRUE, message=FALSE, warning=FALSE}
# Create the plot with new customisations
p1 <- ggplot(data1, aes(x = EpisodeNumber, y = Rating, color = factor(Season))) +  
  geom_line() +                        
  geom_point() +                       
  labs(x = "Episode Number",            
       y = "Episode Rating",            
       color = "",                     # Label for the legend
       caption = "Source: IMDB.com") +  # Add source text at the bottom
  ggtitle("Game of Thrones Episode Ratings Per Season") + # Add a title
  theme_minimal() +  # Clean, minimal theme
  scale_color_manual(values = custom_colors) +  # Apply custom colors for lines
  scale_x_continuous(breaks = seq(1, max(data1$EpisodeNumber), by = 1)) +  # Set x-axis breaks
  scale_y_continuous(
    breaks = seq(4, 10, by = 0.5),  # Set y-axis breaks
    limits = c(4, 10),              # Set y-axis limits
    expand = c(0, 0)                # Remove extra padding
  ) + 
  theme(legend.position = "right") +  # Position the legend on the right
  guides(color = guide_legend(
    keywidth = 2,  # Adjust the size of the legend key (box around the color circle)
    keyheight = 2, # Adjust the size of the legend key (box around the color circle)
    override.aes = list(size = 5)  # Increase the size of the color circles inside the legend
  ))

# Display the plot
print(p1)
```
```{r animated plot, echo=TRUE, message=FALSE, warning=FALSE}

anim <- p1 + 
  geom_point() +
  transition_manual(EpisodeNumber, cumulative = TRUE) +
labs(
  subtitle = "Episode: {frame}"  # Add a dynamic subtitle that changes with each frame
)

print(anim)

anim2 <- p1 + 
  geom_point() +
  transition_reveal(EpisodeNumber) +
labs(
  subtitle = "Episode: {frame_along}"  # Add a dynamic subtitle that changes with each frame
)

print(anim2)
```









